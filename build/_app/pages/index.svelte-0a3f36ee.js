var Ot=Object.defineProperty,jt=Object.defineProperties;var Et=Object.getOwnPropertyDescriptors;var at=Object.getOwnPropertySymbols;var Nt=Object.prototype.hasOwnProperty,Tt=Object.prototype.propertyIsEnumerable;var it=(e,t,n)=>t in e?Ot(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ut=(e,t)=>{for(var n in t||(t={}))Nt.call(t,n)&&it(e,n,t[n]);if(at)for(var n of at(t))Tt.call(t,n)&&it(e,n,t[n]);return e},ct=(e,t)=>jt(e,Et(t));import{S as U,i as V,s as P,G as nt,H as ot,I as st,q as M,o as j,e as D,c as I,a as q,d as w,b as R,g as S,M as St,N as C,n as gt,p as ht,O as _t,P as Zt,r as Dt,Q as It,F as lt,R as O,k as G,m as W,L as tt,v as rt,T as K,E as x,U as qt,V as Pt,t as Rt,w as F,h as Ut,x as L,J as A,y as X,W as Vt,B as Y,K as Bt,X as Jt}from"../chunks/index-d36043ac.js";import{c as Q,i as $,E as Gt}from"../chunks/Earthquakes-e95c3c2c.js";import{w as ft}from"../chunks/index-fb66156c.js";import"./MiniScroller.svelte-5fd002f6.js";function Wt(e,t){for(const{type:n,value:o,id:s}of e){if(document.getElementById(s)){n==="script"&&t();return}const a=document.createElement(n);a.id=s,n==="script"?(a.async=!0,a.defer=!0,a.src=o,a.onload=()=>t()):(a.rel="stylesheet",a.href=o),document.body.appendChild(a)}}function bt(e,t,n,o){const s=[];for(const[l,a]of Object.entries(t)){const u=c=>{const[i,r]=a(e,c,n);o.dispatchEvent(new CustomEvent(i,{detail:r}))};e.on(l,u),s.push([l,u])}return()=>{for(const[l,a]of s)e.off(l,a)}}function xt(e,t={}){const n=[{type:"script",attr:"src",value:`//api.mapbox.com/mapbox-gl-js/${t.version}/mapbox-gl.js`,id:"byk-gl-js"},{type:"link",attr:"href",value:`//api.mapbox.com/mapbox-gl-js/${t.version}/mapbox-gl.css`,id:"byk-gl-css"}],o=t.customStylesheetUrl;o&&n.push({type:"link",attr:"href",value:o,id:"byk-mcsu-css"});let s=()=>{};return Wt(n,()=>{s=Ft(ct(ut({},t),{container:e}),e)}),{destroy(){s()}}}function Ft(e,t){window.mapboxgl.accessToken=e.accessToken;const n=new window.mapboxgl.Map(e);return bt(n,Lt,window.mapboxgl,t)}const Lt={dragend:e=>["dragend",{center:e.getCenter()}],drag:e=>["drag",{center:e.getCenter()}],moveend:e=>["recentre",{center:e.getCenter()}],click:(e,{lngLat:t})=>["click",{lng:t.lng,lat:t.lat}],zoomstart:e=>["zoomstart",{zoom:e.getZoom()}],zoom:e=>["zoom",{zoom:e.getZoom()}],zoomend:e=>["zoomend",{zoom:e.getZoom()}],load:(e,t,n)=>["ready",{map:e,mapbox:n}]};class Xt{constructor(){this.queue=ft([]),this.unsubscribe=null,this.started=!1}send(t,n=[]){!t||this.queue.update(o=>[...o,[t,n]])}start(t){this.unsubscribe=this.queue.subscribe(n=>{for(;n.length;){const[o,s]=n.shift();t[o].apply(t,s)}}),this.started=!0}stop(){!this.started||(this.unsubscribe(),this.queue=ft([]),this.started=!1)}}function mt(e){let t;const n=e[21].default,o=lt(n,e,e[20],null);return{c(){o&&o.c()},l(s){o&&o.l(s)},m(s,l){o&&o.m(s,l),t=!0},p(s,l){o&&o.p&&(!t||l[0]&1048576)&&nt(o,n,s,s[20],t?st(n,s[20],l,null):ot(s[20]),null)},i(s){t||(M(o,s),t=!0)},o(s){j(o,s),t=!1},d(s){o&&o.d(s)}}}function Yt(e){let t,n,o,s,l=e[0]&&mt(e);return{c(){t=D("div"),l&&l.c(),this.h()},l(a){t=I(a,"DIV",{class:!0});var u=q(t);l&&l.l(u),u.forEach(w),this.h()},h(){R(t,"class","svelte-1kuj9kb")},m(a,u){S(a,t,u),l&&l.m(t,null),n=!0,o||(s=[St(xt.call(null,t,e[1])),C(t,"ready",e[2]),C(t,"recentre",e[22]),C(t,"dragend",e[23]),C(t,"click",e[24]),C(t,"zoomstart",e[25]),C(t,"zoom",e[26]),C(t,"zoomend",e[27]),C(t,"drag",e[28])],o=!0)},p(a,u){a[0]?l?(l.p(a,u),u[0]&1&&M(l,1)):(l=mt(a),l.c(),M(l,1),l.m(t,null)):l&&(gt(),j(l,1,1,()=>{l=null}),ht())},i(a){n||(M(l),n=!0)},o(a){j(l),n=!1},d(a){a&&w(t),l&&l.d(),o=!1,_t(s)}}}function Kt(e,t,n){let{$$slots:o={},$$scope:s}=t,{map:l=null}=t,{version:a="v2.3.1"}=t,{center:u=[0,0]}=t,{zoom:c=9}=t,{zoomRate:i=1}=t,{wheelZoomRate:r=1}=t,{options:d={}}=t,{accessToken:k}=t,{customStylesheetUrl:g=!1}=t,{style:b="mapbox://styles/mapbox/streets-v11"}=t;const y=Zt();Dt(Q,{getMap:()=>l,getMapbox:()=>E});let v,E;const h=Object.assign({accessToken:k,container:v,style:b,center:u,zoom:c,zoomRate:i,wheelZoomRate:r,version:a,customStylesheetUrl:g,map:l},d),m=new Xt;function _({detail:f}){n(0,l=f.map),E=f.mapbox,m.start(l),y("ready")}It(()=>{m.stop(),n(0,l=void 0)});function z(f,T={}){m.send("fitBounds",[f,T])}function N(f,T={}){m.send("flyTo",[f,T])}function Z(){m.send("resize")}function et(f,T={}){m.send("setCenter",[f,T])}function H(f,T={}){m.send("setZoom",[f,T])}function p(f,T="top-right"){m.send("addControl",[f,T])}function B(){return l}function J(){return E}function kt(f){O.call(this,e,f)}function yt(f){O.call(this,e,f)}function wt(f){O.call(this,e,f)}function zt(f){O.call(this,e,f)}function Ct(f){O.call(this,e,f)}function Mt(f){O.call(this,e,f)}function vt(f){O.call(this,e,f)}return e.$$set=f=>{"map"in f&&n(0,l=f.map),"version"in f&&n(3,a=f.version),"center"in f&&n(4,u=f.center),"zoom"in f&&n(5,c=f.zoom),"zoomRate"in f&&n(6,i=f.zoomRate),"wheelZoomRate"in f&&n(7,r=f.wheelZoomRate),"options"in f&&n(8,d=f.options),"accessToken"in f&&n(9,k=f.accessToken),"customStylesheetUrl"in f&&n(10,g=f.customStylesheetUrl),"style"in f&&n(11,b=f.style),"$$scope"in f&&n(20,s=f.$$scope)},e.$$.update=()=>{e.$$.dirty[0]&32&&c&&H(c)},[l,h,_,a,u,c,i,r,d,k,g,b,z,N,Z,et,H,p,B,J,s,o,kt,yt,wt,zt,Ct,Mt,vt]}class Qt extends U{constructor(t){super(),V(this,t,Kt,Yt,P,{map:0,version:3,center:4,zoom:5,zoomRate:6,wheelZoomRate:7,options:8,accessToken:9,customStylesheetUrl:10,style:11,fitBounds:12,flyTo:13,resize:14,setCenter:15,setZoom:16,addControl:17,getMap:18,getMapbox:19},null,[-1,-1])}get fitBounds(){return this.$$.ctx[12]}get flyTo(){return this.$$.ctx[13]}get resize(){return this.$$.ctx[14]}get setCenter(){return this.$$.ctx[15]}get setZoom(){return this.$$.ctx[16]}get addControl(){return this.$$.ctx[17]}get getMap(){return this.$$.ctx[18]}get getMapbox(){return this.$$.ctx[19]}}const Ht=e=>({}),dt=e=>({});function At(e){let t,n,o,s;const l=e[15].default,a=lt(l,e,e[14],null),u=e[15].popup,c=lt(u,e,e[14],dt);return{c(){t=D("div"),a&&a.c(),n=G(),o=D("div"),c&&c.c(),this.h()},l(i){t=I(i,"DIV",{});var r=q(t);a&&a.l(r),r.forEach(w),n=W(i),o=I(i,"DIV",{class:!0});var d=q(o);c&&c.l(d),d.forEach(w),this.h()},h(){R(o,"class","popup")},m(i,r){S(i,t,r),a&&a.m(t,null),e[16](t),S(i,n,r),S(i,o,r),c&&c.m(o,null),e[17](o),s=!0},p(i,[r]){a&&a.p&&(!s||r&16384)&&nt(a,l,i,i[14],s?st(l,i[14],r,null):ot(i[14]),null),c&&c.p&&(!s||r&16384)&&nt(c,u,i,i[14],s?st(u,i[14],r,Ht):ot(i[14]),dt)},i(i){s||(M(a,i),M(c,i),s=!0)},o(i){j(a,i),j(c,i),s=!1},d(i){i&&w(t),a&&a.d(i),e[16](null),i&&w(n),i&&w(o),c&&c.d(i),e[17](null)}}}function $t(){return Math.round(Math.random()*255)}function te(e,t,n){let{$$slots:o={},$$scope:s}=t;const{getMap:l,getMapbox:a}=tt(Q),u=l(),c=a();function i(p,B){_.setLngLat({lng:p,lat:B})}let{lat:r}=t,{lng:d}=t,{label:k="Marker"}=t,{popupClassName:g="beyonk-mapbox-popup"}=t,{markerOffset:b=[0,0]}=t,{popupOffset:y=10}=t,{color:v=$t()}=t,{popup:E=!0}=t,{popupOptions:h={}}=t,{markerOptions:m={}}=t,_,z,N;rt(()=>{const p=Object.assign({offset:b},z.hasChildNodes()?{element:z}:{color:v});if(n(13,_=new c.Marker(Object.assign(p,m))),E){const B={offset:y,className:g},J=new c.Popup(Object.assign(B,h));N.hasChildNodes()?J.setDOMContent(N):J.setText(k),_.setPopup(J)}return _.setLngLat({lng:d,lat:r}).addTo(u),()=>_.remove()});function Z(){return _}function et(p){K[p?"unshift":"push"](()=>{z=p,n(0,z)})}function H(p){K[p?"unshift":"push"](()=>{N=p,n(1,N)})}return e.$$set=p=>{"lat"in p&&n(2,r=p.lat),"lng"in p&&n(3,d=p.lng),"label"in p&&n(4,k=p.label),"popupClassName"in p&&n(5,g=p.popupClassName),"markerOffset"in p&&n(6,b=p.markerOffset),"popupOffset"in p&&n(7,y=p.popupOffset),"color"in p&&n(8,v=p.color),"popup"in p&&n(9,E=p.popup),"popupOptions"in p&&n(10,h=p.popupOptions),"markerOptions"in p&&n(11,m=p.markerOptions),"$$scope"in p&&n(14,s=p.$$scope)},e.$$.update=()=>{e.$$.dirty&8204&&_&&i(d,r)},[z,N,r,d,k,g,b,y,v,E,h,m,Z,_,s,o,et,H]}class ee extends U{constructor(t){super(),V(this,t,te,At,P,{lat:2,lng:3,label:4,popupClassName:5,markerOffset:6,popupOffset:7,color:8,popup:9,popupOptions:10,markerOptions:11,getMarker:12})}get getMarker(){return this.$$.ctx[12]}}function ne(e){let t,n,o;return{c(){t=D("div"),this.h()},l(s){t=I(s,"DIV",{class:!0}),q(t).forEach(w),this.h()},h(){R(t,"class","svelte-1pfu5h6")},m(s,l){S(s,t,l),e[9](t),n||(o=[C(t,"error",e[4]),C(t,"geolocate",e[5]),C(t,"outofmaxbounds",e[6]),C(t,"trackuserlocationend",e[7]),C(t,"trackuserlocationstart",e[8])],n=!0)},p:x,i:x,o:x,d(s){s&&w(t),e[9](null),n=!1,_t(o)}}}function oe(e,t,n){const{getMap:o,getMapbox:s}=tt(Q),l=o(),a=s();let{position:u="top-left"}=t,{options:c={}}=t,i;const r={error:(m,_)=>["error",_],geolocate:(m,_)=>["geolocate",_],outofmaxbounds:(m,_)=>["outofmaxbounds",_],trackuserlocationend:(m,_)=>["trackuserlocationend",_],trackuserlocationstart:(m,_)=>["trackuserlocationstart",_]},d=new a.GeolocateControl(c);l.addControl(d,u),rt(()=>bt(d,r,a,i));function k(){d.trigger()}function g(m){O.call(this,e,m)}function b(m){O.call(this,e,m)}function y(m){O.call(this,e,m)}function v(m){O.call(this,e,m)}function E(m){O.call(this,e,m)}function h(m){K[m?"unshift":"push"](()=>{i=m,n(0,i)})}return e.$$set=m=>{"position"in m&&n(1,u=m.position),"options"in m&&n(2,c=m.options)},[i,u,c,k,g,b,y,v,E,h]}class se extends U{constructor(t){super(),V(this,t,oe,ne,P,{position:1,options:2,trigger:3})}get trigger(){return this.$$.ctx[3]}}function le(e,t,n){const{getMap:o,getMapbox:s}=tt(Q),l=o(),a=s();let{position:u="top-right"}=t,{options:c={}}=t;const i=new a.NavigationControl(c);return l.addControl(i,u),e.$$set=r=>{"position"in r&&n(0,u=r.position),"options"in r&&n(1,c=r.options)},[u,c]}class re extends U{constructor(t){super(),V(this,t,le,null,P,{position:0,options:1})}}function ae(e,t,n){const{getMap:o,getMapbox:s}=tt(Q),l=o(),a=s();let{position:u="bottom-right"}=t,{options:c={}}=t;const i=Object.assign({maxWidth:80,unit:"metric"},c),r=new a.ScaleControl(i);return l.addControl(r,u),e.$$set=d=>{"position"in d&&n(0,u=d.position),"options"in d&&n(1,c=d.options)},[u,c]}class ie extends U{constructor(t){super(),V(this,t,ae,null,P,{position:0,options:1})}}const ue={GeolocateControl:se,NavigationControl:re,ScaleControl:ie},ce="pk.eyJ1IjoibGV0b3VycG93ZXJzY29tYmluZSIsImEiOiJjazFmN3N0eTUwb3JwM2JwYWk4ZXB1enNtIn0._UjpOqZIeiWqhscosubipw";function pt(e){let t,n;return t=new Gt({}),{c(){F(t.$$.fragment)},l(o){L(t.$$.fragment,o)},m(o,s){X(t,o,s),n=!0},p:x,i(o){n||(M(t.$$.fragment,o),n=!0)},o(o){j(t.$$.fragment,o),n=!1},d(o){Y(t,o)}}}function fe(e){let t=e[4],n,o,s,l,a,u,c,i=pt();return o=new e[6]({}),l=new e[5]({}),l.$on("geolocate",e[11]),u=new ee({props:{lat:e[1].lat,lng:e[1].lng}}),{c(){i.c(),n=G(),F(o.$$.fragment),s=G(),F(l.$$.fragment),a=G(),F(u.$$.fragment)},l(r){i.l(r),n=W(r),L(o.$$.fragment,r),s=W(r),L(l.$$.fragment,r),a=W(r),L(u.$$.fragment,r)},m(r,d){i.m(r,d),S(r,n,d),X(o,r,d),S(r,s,d),X(l,r,d),S(r,a,d),X(u,r,d),c=!0},p(r,d){d&16&&P(t,t=r[4])?(gt(),j(i,1,1,x),ht(),i=pt(),i.c(),M(i),i.m(n.parentNode,n)):i.p(r,d);const k={};d&2&&(k.lat=r[1].lat),d&2&&(k.lng=r[1].lng),u.$set(k)},i(r){c||(M(i),M(o.$$.fragment,r),M(l.$$.fragment,r),M(u.$$.fragment,r),c=!0)},o(r){j(i),j(o.$$.fragment,r),j(l.$$.fragment,r),j(u.$$.fragment,r),c=!1},d(r){i.d(r),r&&w(n),Y(o,r),r&&w(s),Y(l,r),r&&w(a),Y(u,r)}}}function me(e){let t,n,o,s,l,a,u,c,i,r;function d(g){e[13](g)}let k={accessToken:ce,center:e[0],$$slots:{default:[fe]},$$scope:{ctx:e}};return e[2]!==void 0&&(k.zoom=e[2]),a=new Qt({props:k}),e[12](a),K.push(()=>Pt(a,"zoom",d)),a.$on("recentre",e[8]),a.$on("drag",e[9]),{c(){t=D("div"),n=D("button"),o=Rt("Publish Site"),s=G(),l=D("div"),F(a.$$.fragment),this.h()},l(g){t=I(g,"DIV",{class:!0,id:!0});var b=q(t);n=I(b,"BUTTON",{});var y=q(n);o=Ut(y,"Publish Site"),y.forEach(w),s=W(b),l=I(b,"DIV",{class:!0});var v=q(l);L(a.$$.fragment,v),v.forEach(w),b.forEach(w),this.h()},h(){R(l,"class","map-wrap svelte-1624f9n"),R(t,"class","section-txt"),R(t,"id","map")},m(g,b){S(g,t,b),A(t,n),A(n,o),A(t,s),A(t,l),X(a,l,null),c=!0,i||(r=C(n,"click",e[7]),i=!0)},p(g,[b]){const y={};b&1&&(y.center=g[0]),b&1048594&&(y.$$scope={dirty:b,ctx:g}),!u&&b&4&&(u=!0,y.zoom=g[2],Vt(()=>u=!1)),a.$set(y)},i(g){c||(M(a.$$.fragment,g),c=!0)},o(g){j(a.$$.fragment,g),c=!1},d(g){g&&w(t),e[12](null),Y(a),i=!1,r()}}}const ke=async({fetch:e})=>{const t=await e("/load_sites",{method:"get"});if(t.ok){console.log("okay");const s=await t.json();let l=qt($);for(var n=0;n<s.table.length;n++){let a={type:"Feature",properties:{id:s.table[n].id,mag:4.1,time:1507411448780,felt:null,tsunami:0},geometry:{type:"Point",coordinates:[s.table[n].lng,s.table[n].lat,0]}};l.push(a)}return $.set(l),{props:{sites:s.table}}}else console.log(t);const{message:o}=await t.json();return{error:new Error(o)}};function de(e,t,n){let o;Bt(e,$,h=>n(15,o=h));let{sites:s}=t;const{GeolocateControl:l,NavigationControl:a}=ue;let u={lat:38.88,lng:-77.1318825263977},c=u,i=14,r,d={};rt(async()=>{console.log(s)});async function k(h){console.log(h.detail);var m=new FormData;m.append("perspective",Math.floor(Date.now()/1e3)),m.append("lng",u.lng),m.append("lat",u.lat),m.append("lng_lat",JSON.stringify(u.lng,u.lat)),console.log(m);const _=await fetch("/publish_location",{method:"post",body:m});if(_.ok){let z=await _.json(),N={type:"Feature",properties:{id:z[0].id,mag:4.1,time:1507411448780,felt:null,tsunami:0},geometry:{type:"Point",coordinates:[z[0].lng,z[0].lat,0]}},Z=o;console.log(Z),Z.push(N),console.log(Z),Jt($,o=Z,o),n(4,d={})}else{let z=await _.json();console.log(z),console.log(z.status),console.log(_.body)}}function g({detail:h}){n(0,u=h.center)}function b({detail:h}){n(1,c=h.center)}const y=h=>console.log("geolocated",h.detail);function v(h){K[h?"unshift":"push"](()=>{r=h,n(3,r)})}function E(h){i=h,n(2,i)}return e.$$set=h=>{"sites"in h&&n(10,s=h.sites)},[u,c,i,r,d,l,a,k,g,b,s,y,v,E]}class ye extends U{constructor(t){super(),V(this,t,de,me,P,{sites:10})}}export{ye as default,ke as load};
