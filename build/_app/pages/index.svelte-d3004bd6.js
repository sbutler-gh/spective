var Ee=Object.defineProperty,Te=Object.defineProperties;var qe=Object.getOwnPropertyDescriptors;var ie=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var le=(t,e,n)=>e in t?Ee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ue=(t,e)=>{for(var n in e||(e={}))Se.call(e,n)&&le(t,n,e[n]);if(ie)for(var n of ie(e))je.call(e,n)&&le(t,n,e[n]);return t},ce=(t,e)=>Te(t,qe(e));import{S,i as j,s as q,G as te,H as ne,I as oe,q as y,o as v,e as R,c as D,a as L,d as b,b as P,g as z,K as Ne,L as k,n as pe,p as ge,M as he,N as Ze,r as Ie,O as xe,F as se,P as C,k as Q,m as X,Q as H,v as ae,R as Y,E as x,t as Re,h as De,J as _e,j as Le,T as be,U as Pe,V as Ge,w as V,x as F,y as J,W as Ue,B as W}from"../chunks/index-da32ce4b.js";import{w as re}from"../chunks/index-d19cd493.js";const Be="pk.eyJ1IjoibGV0b3VycG93ZXJzY29tYmluZSIsImEiOiJjazFmN3N0eTUwb3JwM2JwYWk4ZXB1enNtIn0._UjpOqZIeiWqhscosubipw",G={};function Ve(t,e){for(const{type:n,value:o,id:s}of t){if(document.getElementById(s)){n==="script"&&e();return}const r=document.createElement(n);r.id=s,n==="script"?(r.async=!0,r.defer=!0,r.src=o,r.onload=()=>e()):(r.rel="stylesheet",r.href=o),document.body.appendChild(r)}}function ke(t,e,n,o){const s=[];for(const[l,r]of Object.entries(e)){const c=u=>{const[a,i]=r(t,u,n);o.dispatchEvent(new CustomEvent(a,{detail:i}))};t.on(l,c),s.push([l,c])}return()=>{for(const[l,r]of s)t.off(l,r)}}function Fe(t,e={}){const n=[{type:"script",attr:"src",value:`//api.mapbox.com/mapbox-gl-js/${e.version}/mapbox-gl.js`,id:"byk-gl-js"},{type:"link",attr:"href",value:`//api.mapbox.com/mapbox-gl-js/${e.version}/mapbox-gl.css`,id:"byk-gl-css"}],o=e.customStylesheetUrl;o&&n.push({type:"link",attr:"href",value:o,id:"byk-mcsu-css"});let s=()=>{};return Ve(n,()=>{s=Je(ce(ue({},e),{container:t}),t)}),{destroy(){s()}}}function Je(t,e){window.mapboxgl.accessToken=t.accessToken;const n=new window.mapboxgl.Map(t);return ke(n,We,window.mapboxgl,e)}const We={dragend:t=>["dragend",{center:t.getCenter()}],drag:t=>["drag",{center:t.getCenter()}],moveend:t=>["recentre",{center:t.getCenter()}],click:(t,{lngLat:e})=>["click",{lng:e.lng,lat:e.lat}],zoomstart:t=>["zoomstart",{zoom:t.getZoom()}],zoom:t=>["zoom",{zoom:t.getZoom()}],zoomend:t=>["zoomend",{zoom:t.getZoom()}],load:(t,e,n)=>["ready",{map:t,mapbox:n}]};class Ye{constructor(){this.queue=re([]),this.unsubscribe=null,this.started=!1}send(e,n=[]){!e||this.queue.update(o=>[...o,[e,n]])}start(e){this.unsubscribe=this.queue.subscribe(n=>{for(;n.length;){const[o,s]=n.shift();e[o].apply(e,s)}}),this.started=!0}stop(){!this.started||(this.unsubscribe(),this.queue=re([]),this.started=!1)}}function fe(t){let e;const n=t[21].default,o=se(n,t,t[20],null);return{c(){o&&o.c()},l(s){o&&o.l(s)},m(s,l){o&&o.m(s,l),e=!0},p(s,l){o&&o.p&&(!e||l[0]&1048576)&&te(o,n,s,s[20],e?oe(n,s[20],l,null):ne(s[20]),null)},i(s){e||(y(o,s),e=!0)},o(s){v(o,s),e=!1},d(s){o&&o.d(s)}}}function He(t){let e,n,o,s,l=t[0]&&fe(t);return{c(){e=R("div"),l&&l.c(),this.h()},l(r){e=D(r,"DIV",{class:!0});var c=L(e);l&&l.l(c),c.forEach(b),this.h()},h(){P(e,"class","svelte-1kuj9kb")},m(r,c){z(r,e,c),l&&l.m(e,null),n=!0,o||(s=[Ne(Fe.call(null,e,t[1])),k(e,"ready",t[2]),k(e,"recentre",t[22]),k(e,"dragend",t[23]),k(e,"click",t[24]),k(e,"zoomstart",t[25]),k(e,"zoom",t[26]),k(e,"zoomend",t[27]),k(e,"drag",t[28])],o=!0)},p(r,c){r[0]?l?(l.p(r,c),c[0]&1&&y(l,1)):(l=fe(r),l.c(),y(l,1),l.m(e,null)):l&&(pe(),v(l,1,1,()=>{l=null}),ge())},i(r){n||(y(l),n=!0)},o(r){v(l),n=!1},d(r){r&&b(e),l&&l.d(),o=!1,he(s)}}}function Ke(t,e,n){let{$$slots:o={},$$scope:s}=e,{map:l=null}=e,{version:r="v2.3.1"}=e,{center:c=[0,0]}=e,{zoom:u=9}=e,{zoomRate:a=1}=e,{wheelZoomRate:i=1}=e,{options:m={}}=e,{accessToken:_}=e,{customStylesheetUrl:w=!1}=e,{style:M="mapbox://styles/mapbox/streets-v11"}=e;const O=Ze();Ie(G,{getMap:()=>l,getMapbox:()=>E});let g,E;const N=Object.assign({accessToken:_,container:g,style:M,center:c,zoom:u,zoomRate:a,wheelZoomRate:i,version:r,customStylesheetUrl:w,map:l},m),d=new Ye;function h({detail:f}){n(0,l=f.map),E=f.mapbox,d.start(l),O("ready")}xe(()=>{d.stop(),n(0,l=void 0)});function Z(f,T={}){d.send("fitBounds",[f,T])}function I(f,T={}){d.send("flyTo",[f,T])}function $(){d.send("resize")}function ee(f,T={}){d.send("setCenter",[f,T])}function K(f,T={}){d.send("setZoom",[f,T])}function p(f,T="top-right"){d.send("addControl",[f,T])}function U(){return l}function B(){return E}function ye(f){C.call(this,t,f)}function Ce(f){C.call(this,t,f)}function ve(f){C.call(this,t,f)}function we(f){C.call(this,t,f)}function Me(f){C.call(this,t,f)}function ze(f){C.call(this,t,f)}function Oe(f){C.call(this,t,f)}return t.$$set=f=>{"map"in f&&n(0,l=f.map),"version"in f&&n(3,r=f.version),"center"in f&&n(4,c=f.center),"zoom"in f&&n(5,u=f.zoom),"zoomRate"in f&&n(6,a=f.zoomRate),"wheelZoomRate"in f&&n(7,i=f.wheelZoomRate),"options"in f&&n(8,m=f.options),"accessToken"in f&&n(9,_=f.accessToken),"customStylesheetUrl"in f&&n(10,w=f.customStylesheetUrl),"style"in f&&n(11,M=f.style),"$$scope"in f&&n(20,s=f.$$scope)},t.$$.update=()=>{t.$$.dirty[0]&32&&u&&K(u)},[l,N,h,r,c,u,a,i,m,_,w,M,Z,I,$,ee,K,p,U,B,s,o,ye,Ce,ve,we,Me,ze,Oe]}class Qe extends S{constructor(e){super(),j(this,e,Ke,He,q,{map:0,version:3,center:4,zoom:5,zoomRate:6,wheelZoomRate:7,options:8,accessToken:9,customStylesheetUrl:10,style:11,fitBounds:12,flyTo:13,resize:14,setCenter:15,setZoom:16,addControl:17,getMap:18,getMapbox:19},null,[-1,-1])}get fitBounds(){return this.$$.ctx[12]}get flyTo(){return this.$$.ctx[13]}get resize(){return this.$$.ctx[14]}get setCenter(){return this.$$.ctx[15]}get setZoom(){return this.$$.ctx[16]}get addControl(){return this.$$.ctx[17]}get getMap(){return this.$$.ctx[18]}get getMapbox(){return this.$$.ctx[19]}}const Xe=t=>({}),me=t=>({});function Ae(t){let e,n,o,s;const l=t[15].default,r=se(l,t,t[14],null),c=t[15].popup,u=se(c,t,t[14],me);return{c(){e=R("div"),r&&r.c(),n=Q(),o=R("div"),u&&u.c(),this.h()},l(a){e=D(a,"DIV",{});var i=L(e);r&&r.l(i),i.forEach(b),n=X(a),o=D(a,"DIV",{class:!0});var m=L(o);u&&u.l(m),m.forEach(b),this.h()},h(){P(o,"class","popup")},m(a,i){z(a,e,i),r&&r.m(e,null),t[16](e),z(a,n,i),z(a,o,i),u&&u.m(o,null),t[17](o),s=!0},p(a,[i]){r&&r.p&&(!s||i&16384)&&te(r,l,a,a[14],s?oe(l,a[14],i,null):ne(a[14]),null),u&&u.p&&(!s||i&16384)&&te(u,c,a,a[14],s?oe(c,a[14],i,Xe):ne(a[14]),me)},i(a){s||(y(r,a),y(u,a),s=!0)},o(a){v(r,a),v(u,a),s=!1},d(a){a&&b(e),r&&r.d(a),t[16](null),a&&b(n),a&&b(o),u&&u.d(a),t[17](null)}}}function $e(){return Math.round(Math.random()*255)}function et(t,e,n){let{$$slots:o={},$$scope:s}=e;const{getMap:l,getMapbox:r}=H(G),c=l(),u=r();function a(p,U){h.setLngLat({lng:p,lat:U})}let{lat:i}=e,{lng:m}=e,{label:_="Marker"}=e,{popupClassName:w="beyonk-mapbox-popup"}=e,{markerOffset:M=[0,0]}=e,{popupOffset:O=10}=e,{color:g=$e()}=e,{popup:E=!0}=e,{popupOptions:N={}}=e,{markerOptions:d={}}=e,h,Z,I;ae(()=>{const p=Object.assign({offset:M},Z.hasChildNodes()?{element:Z}:{color:g});if(n(13,h=new u.Marker(Object.assign(p,d))),E){const U={offset:O,className:w},B=new u.Popup(Object.assign(U,N));I.hasChildNodes()?B.setDOMContent(I):B.setText(_),h.setPopup(B)}return h.setLngLat({lng:m,lat:i}).addTo(c),()=>h.remove()});function $(){return h}function ee(p){Y[p?"unshift":"push"](()=>{Z=p,n(0,Z)})}function K(p){Y[p?"unshift":"push"](()=>{I=p,n(1,I)})}return t.$$set=p=>{"lat"in p&&n(2,i=p.lat),"lng"in p&&n(3,m=p.lng),"label"in p&&n(4,_=p.label),"popupClassName"in p&&n(5,w=p.popupClassName),"markerOffset"in p&&n(6,M=p.markerOffset),"popupOffset"in p&&n(7,O=p.popupOffset),"color"in p&&n(8,g=p.color),"popup"in p&&n(9,E=p.popup),"popupOptions"in p&&n(10,N=p.popupOptions),"markerOptions"in p&&n(11,d=p.markerOptions),"$$scope"in p&&n(14,s=p.$$scope)},t.$$.update=()=>{t.$$.dirty&8204&&h&&a(m,i)},[Z,I,i,m,_,w,M,O,g,E,N,d,$,h,s,o,ee,K]}class tt extends S{constructor(e){super(),j(this,e,et,Ae,q,{lat:2,lng:3,label:4,popupClassName:5,markerOffset:6,popupOffset:7,color:8,popup:9,popupOptions:10,markerOptions:11,getMarker:12})}get getMarker(){return this.$$.ctx[12]}}function nt(t){let e,n,o;return{c(){e=R("div"),this.h()},l(s){e=D(s,"DIV",{class:!0}),L(e).forEach(b),this.h()},h(){P(e,"class","svelte-1pfu5h6")},m(s,l){z(s,e,l),t[9](e),n||(o=[k(e,"error",t[4]),k(e,"geolocate",t[5]),k(e,"outofmaxbounds",t[6]),k(e,"trackuserlocationend",t[7]),k(e,"trackuserlocationstart",t[8])],n=!0)},p:x,i:x,o:x,d(s){s&&b(e),t[9](null),n=!1,he(o)}}}function ot(t,e,n){const{getMap:o,getMapbox:s}=H(G),l=o(),r=s();let{position:c="top-left"}=e,{options:u={}}=e,a;const i={error:(d,h)=>["error",h],geolocate:(d,h)=>["geolocate",h],outofmaxbounds:(d,h)=>["outofmaxbounds",h],trackuserlocationend:(d,h)=>["trackuserlocationend",h],trackuserlocationstart:(d,h)=>["trackuserlocationstart",h]},m=new r.GeolocateControl(u);l.addControl(m,c),ae(()=>ke(m,i,r,a));function _(){m.trigger()}function w(d){C.call(this,t,d)}function M(d){C.call(this,t,d)}function O(d){C.call(this,t,d)}function g(d){C.call(this,t,d)}function E(d){C.call(this,t,d)}function N(d){Y[d?"unshift":"push"](()=>{a=d,n(0,a)})}return t.$$set=d=>{"position"in d&&n(1,c=d.position),"options"in d&&n(2,u=d.options)},[a,c,u,_,w,M,O,g,E,N]}class st extends S{constructor(e){super(),j(this,e,ot,nt,q,{position:1,options:2,trigger:3})}get trigger(){return this.$$.ctx[3]}}function rt(t,e,n){const{getMap:o,getMapbox:s}=H(G),l=o(),r=s();let{position:c="top-right"}=e,{options:u={}}=e;const a=new r.NavigationControl(u);return l.addControl(a,c),t.$$set=i=>{"position"in i&&n(0,c=i.position),"options"in i&&n(1,u=i.options)},[c,u]}class at extends S{constructor(e){super(),j(this,e,rt,null,q,{position:0,options:1})}}function it(t,e,n){const{getMap:o,getMapbox:s}=H(G),l=o(),r=s();let{position:c="bottom-right"}=e,{options:u={}}=e;const a=Object.assign({maxWidth:80,unit:"metric"},u),i=new r.ScaleControl(a);return l.addControl(i,c),t.$$set=m=>{"position"in m&&n(0,c=m.position),"options"in m&&n(1,u=m.options)},[c,u]}class lt extends S{constructor(e){super(),j(this,e,it,null,q,{position:0,options:1})}}const ut={GeolocateControl:st,NavigationControl:at,ScaleControl:lt};function ct(t){let e,n;return{c(){e=R("p"),n=Re(t[0])},l(o){e=D(o,"P",{});var s=L(e);n=De(s,t[0]),s.forEach(b)},m(o,s){z(o,e,s),_e(e,n)},p(o,[s]){s&1&&Le(n,o[0])},i:x,o:x,d(o){o&&b(e)}}}function ft(t,e,n){let{id:o="test"}=e;return t.$$set=s=>{"id"in s&&n(0,o=s.id)},[o]}class mt extends S{constructor(e){super(),j(this,e,ft,ct,q,{id:0})}}let A=re([]);function dt(t,e,n){let o;be(t,A,u=>n(0,o=u));const{getMap:s,getMapbox:l}=H(G),r=s(),c=l();if(r.getSource("earthquakes")){console.log("exists");let u={type:"FeatureCollection",crs:{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},features:o};r.getSource("earthquakes").setData(u)}else r.addSource("earthquakes",{type:"geojson",data:{type:"FeatureCollection",crs:{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},features:o},cluster:!0,clusterMaxZoom:14,clusterRadius:50}),r.addLayer({id:"clusters",type:"circle",source:"earthquakes",filter:["has","point_count"],paint:{"circle-color":["step",["get","point_count"],"#51bbd6",100,"#f1f075",750,"#f28cb1"],"circle-radius":["step",["get","point_count"],20,100,30,750,40]}}),r.addLayer({id:"cluster-count",type:"symbol",source:"earthquakes",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12}}),r.addLayer({id:"unclustered-point",type:"circle",source:"earthquakes",filter:["!",["has","point_count"]],paint:{"circle-color":"#11b4da","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}});return r.on("click","clusters",function(u){const a=r.queryRenderedFeatures(u.point,{layers:["clusters"]}),i=a[0].properties.cluster_id;r.getSource("earthquakes").getClusterExpansionZoom(i,function(m,_){m||r.easeTo({center:a[0].geometry.coordinates,zoom:_})})}),r.on("mouseenter","clusters",function(){r.getCanvas().style.cursor="pointer"}),r.on("mouseleave","clusters",function(){r.getCanvas().style.cursor=""}),r.on("click","unclustered-point",function(u){const a=u.features[0].geometry.coordinates.slice();for(;Math.abs(u.lngLat.lng-a[0])>180;)a[0]+=u.lngLat.lng>a[0]?360:-360;console.log(u.features[0]),r.setCenter(a),new c.Popup({}).setLngLat(a).setHTML('<div id="mini-scroller"></div>').addTo(r),new mt({target:document.getElementById("mini-scroller"),props:{id:u.features[0]._vectorTileFeature.properties.id}})}),r.on("mouseenter","unclustered-point",function(){r.getCanvas().style.cursor="pointer"}),r.on("mouseleave","unclustered-point",function(){r.getCanvas().style.cursor=""}),[]}class pt extends S{constructor(e){super(),j(this,e,dt,null,q,{})}}function de(t){let e,n;return e=new pt({}),{c(){V(e.$$.fragment)},l(o){F(e.$$.fragment,o)},m(o,s){J(e,o,s),n=!0},p:x,i(o){n||(y(e.$$.fragment,o),n=!0)},o(o){v(e.$$.fragment,o),n=!1},d(o){W(e,o)}}}function gt(t){let e=t[4],n,o,s,l,r,c,u,a=de();return o=new t[6]({}),l=new t[5]({}),l.$on("geolocate",t[10]),c=new tt({props:{lat:t[1].lat,lng:t[1].lng}}),{c(){a.c(),n=Q(),V(o.$$.fragment),s=Q(),V(l.$$.fragment),r=Q(),V(c.$$.fragment)},l(i){a.l(i),n=X(i),F(o.$$.fragment,i),s=X(i),F(l.$$.fragment,i),r=X(i),F(c.$$.fragment,i)},m(i,m){a.m(i,m),z(i,n,m),J(o,i,m),z(i,s,m),J(l,i,m),z(i,r,m),J(c,i,m),u=!0},p(i,m){m&16&&q(e,e=i[4])?(pe(),v(a,1,1,x),ge(),a=de(),a.c(),y(a),a.m(n.parentNode,n)):a.p(i,m);const _={};m&2&&(_.lat=i[1].lat),m&2&&(_.lng=i[1].lng),c.$set(_)},i(i){u||(y(a),y(o.$$.fragment,i),y(l.$$.fragment,i),y(c.$$.fragment,i),u=!0)},o(i){v(a),v(o.$$.fragment,i),v(l.$$.fragment,i),v(c.$$.fragment,i),u=!1},d(i){a.d(i),i&&b(n),W(o,i),i&&b(s),W(l,i),i&&b(r),W(c,i)}}}function ht(t){let e,n,o,s,l;function r(u){t[12](u)}let c={accessToken:Be,center:t[0],$$slots:{default:[gt]},$$scope:{ctx:t}};return t[2]!==void 0&&(c.zoom=t[2]),o=new Qe({props:c}),t[11](o),Y.push(()=>Ge(o,"zoom",r)),o.$on("recentre",t[7]),o.$on("drag",t[8]),{c(){e=R("div"),n=R("div"),V(o.$$.fragment),this.h()},l(u){e=D(u,"DIV",{class:!0,id:!0});var a=L(e);n=D(a,"DIV",{class:!0});var i=L(n);F(o.$$.fragment,i),i.forEach(b),a.forEach(b),this.h()},h(){P(n,"class","map-wrap svelte-1624f9n"),P(e,"class","section-txt"),P(e,"id","map")},m(u,a){z(u,e,a),_e(e,n),J(o,n,null),l=!0},p(u,[a]){const i={};a&1&&(i.center=u[0]),a&1048594&&(i.$$scope={dirty:a,ctx:u}),!s&&a&4&&(s=!0,i.zoom=u[2],Ue(()=>s=!1)),o.$set(i)},i(u){l||(y(o.$$.fragment,u),l=!0)},o(u){v(o.$$.fragment,u),l=!1},d(u){u&&b(e),t[11](null),W(o)}}}const Ct=async({fetch:t})=>{const e=await t("/load_sites",{method:"get"});if(e.ok){console.log("okay");const s=await e.json();let l=Pe(A);for(var n=0;n<s.table.length;n++){let r={type:"Feature",properties:{id:s.table[n].id,mag:4.1,time:1507411448780,felt:null,tsunami:0},geometry:{type:"Point",coordinates:[s.table[n].lng,s.table[n].lat,0]}};l.push(r)}return A.set(l),{props:{sites:s.table}}}else console.log(e);const{message:o}=await e.json();return{error:new Error(o)}};function _t(t,e,n){be(t,A,g=>n(14,g));let{sites:o}=e;const{GeolocateControl:s,NavigationControl:l}=ut;let r={lat:38.88,lng:-77.1318825263977},c=r,u=14,a,i={};ae(async()=>{console.log(o)});function m({detail:g}){n(0,r=g.center)}function _({detail:g}){n(1,c=g.center)}const w=g=>console.log("geolocated",g.detail);function M(g){Y[g?"unshift":"push"](()=>{a=g,n(3,a)})}function O(g){u=g,n(2,u)}return t.$$set=g=>{"sites"in g&&n(9,o=g.sites)},[r,c,u,a,i,s,l,m,_,o,w,M,O]}class vt extends S{constructor(e){super(),j(this,e,_t,ht,q,{sites:9})}}export{vt as default,Ct as load};
